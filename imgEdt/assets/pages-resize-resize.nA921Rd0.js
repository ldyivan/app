import{g as e,p as t,q as i,u as a,s,v as o,y as l,z as h,x as n,c,w as d,d as r,i as u,o as g,e as m,f as p,k as f,j as w,t as z,F as _,r as v,l as k,A as R,G as C,C as I,I as P,H as b,B as y,D as M,E as x}from"./index-C2v8_cZE.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=S({data:()=>({imagePath:"",resizedPath:"",originalWidth:0,originalHeight:0,width:0,height:0,originalSize:"",resizedSize:"",maintainRatio:!0,aspectRatio:1,scale:100,resizeMode:"percentage",resizeModes:[{label:"按百分比",value:"percentage"},{label:"自定义尺寸",value:"custom"}],currentTheme:e("theme")||"light"}),methods:{goBack(){t()},chooseImage(){i({count:1,success:e=>{a({filePath:e.tempFilePaths[0],success:t=>{t.size>20971520?s({title:"图片不能超过20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.resizedPath="",this.getImageInfo(e.tempFilePaths[0]))}})}})},async getImageInfo(e){try{const[t,i]=await Promise.all([a({filePath:e}),o({src:e})]);this.originalSize=this.formatFileSize(t.size),this.originalWidth=i.width,this.originalHeight=i.height,this.width=i.width,this.height=i.height,this.aspectRatio=i.width/i.height}catch(t){s({title:"获取图片信息失败",icon:"none"})}},onModeChange(e){this.resizeMode=e.detail.value,"percentage"===this.resizeMode?(this.scale=100,this.updateSizeByScale()):(this.width=this.originalWidth,this.height=this.originalHeight)},onWidthInput(e){const t=Number(e.detail.value)||0;if(this.width=t,console.log("宽度输入:",{width:t,maintainRatio:this.maintainRatio,resizeMode:this.resizeMode}),"custom"===this.resizeMode&&this.maintainRatio&&t>0){const e=Math.round(t/this.aspectRatio);console.log("计算新高度:",{width:t,newHeight:e,ratio:this.aspectRatio}),this.height=e}},onHeightInput(e){const t=Number(e.detail.value)||0;if(this.height=t,console.log("高度输入:",{height:t,maintainRatio:this.maintainRatio,resizeMode:this.resizeMode}),"custom"===this.resizeMode&&this.maintainRatio&&t>0){const e=Math.round(t*this.aspectRatio);console.log("计算新宽度:",{height:t,newWidth:e,ratio:this.aspectRatio}),this.width=e}},onRatioChange(e){if(console.log("保持宽高比选项改变前:",{maintainRatio:this.maintainRatio}),this.maintainRatio=!this.maintainRatio,console.log("保持宽高比选项改变后:",{maintainRatio:this.maintainRatio,width:this.width,height:this.height,aspectRatio:this.aspectRatio}),this.maintainRatio&&this.width>0){const e=Math.round(this.width/this.aspectRatio);console.log("重新计算高度:",{width:this.width,newHeight:e,ratio:this.aspectRatio,maintainRatio:this.maintainRatio}),this.height=e}},onScaleChange(e){this.scale=e.detail.value,this.updateSizeByScale()},updateSizeByScale(){this.width=Math.round(this.originalWidth*this.scale/100),this.height=Math.round(this.originalHeight*this.scale/100)},async resizeImage(){if(this.imagePath)if(this.width<=0||this.height<=0)s({title:"尺寸必须大于0",icon:"none"});else{l({title:"处理中..."});try{const e=await this.resizeImageByCanvas(),t=await this.base64ToPath(e),i=await a({filePath:t});this.resizedPath=t,this.resizedSize=this.formatFileSize(i.size),h(),s({title:"调整成功",icon:"success"})}catch(e){console.error("调整失败:",e),h(),s({title:"调整失败",icon:"error"})}}},resizeImageByCanvas(){return new Promise(((e,t)=>{const i=new Image;i.onload=()=>{const t=document.createElement("canvas"),a=t.getContext("2d");t.width=this.width,t.height=this.height,a.drawImage(i,0,0,this.width,this.height),e(t.toDataURL("image/png"))},i.onerror=t,i.src=this.imagePath}))},formatFileSize:e=>e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB",base64ToPath:e=>new Promise(((t,i)=>{const[,a,s]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!a||!s)return void i(new Error("base64 格式错误"));const o=atob(s),l=new Uint8Array(o.length);for(let e=0;e<o.length;e++)l[e]=o.charCodeAt(e);const h=new Blob([l],{type:"image/png"});t(URL.createObjectURL(h))})),previewImage(e){n({urls:[e],current:e})},resetImage(){this.imagePath="",this.resizedPath="",this.originalSize="",this.resizedSize="",this.width=0,this.height=0,this.scale=100,this.$nextTick((()=>{this.chooseImage()}))},saveImage(){try{const e=document.createElement("a");e.href=this.resizedPath;const t=(new Date).getTime();e.download=`resized_image_${t}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),s({title:"开始下载",icon:"success"})}catch(e){console.error("保存失败:",e),s({title:"保存失败",icon:"error"})}}},onShow(){this.currentTheme=e("theme")||"light"}},[["render",function(e,t,i,a,s,o){const l=k,h=u,n=R,S=x,B=C,F=I,H=P,W=b,T=y,j=M;return g(),c(h,{class:r(["container",s.currentTheme])},{default:d((()=>[m(h,{class:"header-fixed"},{default:d((()=>[m(h,{class:"back-btn",onClick:o.goBack},{default:d((()=>[m(l,{class:"back-icon"},{default:d((()=>[p("←")])),_:1})])),_:1},8,["onClick"]),m(l,{class:"title"},{default:d((()=>[p("图片缩放")])),_:1})])),_:1}),m(h,{class:"header-placeholder"}),m(h,{class:"content"},{default:d((()=>[s.imagePath?f("",!0):(g(),c(h,{key:0,class:"upload-box",onClick:o.chooseImage},{default:d((()=>[m(l,{class:"upload-icon"},{default:d((()=>[p("📤")])),_:1}),m(l,{class:"upload-text"},{default:d((()=>[p("点击选择图片")])),_:1}),m(l,{class:"upload-tip"},{default:d((()=>[p("支持jpg、png、webp格式，最大20MB")])),_:1})])),_:1},8,["onClick"])),s.imagePath?(g(),w(_,{key:1},[m(h,{class:"image-info"},{default:d((()=>[m(l,{class:"info-text"},{default:d((()=>[p("原始尺寸: "+z(s.originalWidth)+" x "+z(s.originalHeight),1)])),_:1}),m(l,{class:"info-text"},{default:d((()=>[p("原始大小: "+z(s.originalSize),1)])),_:1}),s.resizedPath?(g(),c(l,{key:0,class:"info-text"},{default:d((()=>[p("调整后尺寸: "+z(s.width)+" x "+z(s.height),1)])),_:1})):f("",!0),s.resizedSize?(g(),c(l,{key:1,class:"info-text"},{default:d((()=>[p("调整后大小: "+z(s.resizedSize),1)])),_:1})):f("",!0)])),_:1}),m(h,{class:"preview-container"},{default:d((()=>[m(h,{class:"preview-box"},{default:d((()=>[m(l,{class:"preview-title"},{default:d((()=>[p("原图")])),_:1}),m(n,{src:s.imagePath,mode:"aspectFit",class:"preview-image",onClick:t[0]||(t[0]=e=>o.previewImage(s.imagePath))},null,8,["src"])])),_:1}),s.resizedPath?(g(),c(h,{key:0,class:"preview-box"},{default:d((()=>[m(l,{class:"preview-title"},{default:d((()=>[p("调整后")])),_:1}),m(n,{src:s.resizedPath,mode:"aspectFit",class:"preview-image",onClick:t[1]||(t[1]=e=>o.previewImage(s.resizedPath))},null,8,["src"])])),_:1})):f("",!0)])),_:1}),m(h,{class:"control-panel"},{default:d((()=>[m(h,{class:"resize-mode"},{default:d((()=>[m(l,{class:"mode-title"},{default:d((()=>[p("缩放模式:")])),_:1}),m(F,{class:"mode-group",onChange:o.onModeChange},{default:d((()=>[(g(!0),w(_,null,v(s.resizeModes,(e=>(g(),c(B,{class:"mode-item",key:e.value},{default:d((()=>[m(S,{value:e.value,checked:s.resizeMode===e.value},null,8,["value","checked"]),m(l,null,{default:d((()=>[p(z(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),"custom"===s.resizeMode?(g(),c(h,{key:0,class:"size-inputs"},{default:d((()=>[m(h,{class:"input-group"},{default:d((()=>[m(l,null,{default:d((()=>[p("宽度 (px)")])),_:1}),m(H,{type:"number",value:s.width,placeholder:"输入宽度",onInput:o.onWidthInput},null,8,["value","onInput"])])),_:1}),m(h,{class:"input-group"},{default:d((()=>[m(l,null,{default:d((()=>[p("高度 (px)")])),_:1}),m(H,{type:"number",value:s.height,placeholder:"输入高度",onInput:o.onHeightInput},null,8,["value","onInput"])])),_:1}),m(h,{class:"ratio-lock"},{default:d((()=>[m(B,null,{default:d((()=>[m(W,{onClick:o.onRatioChange,checked:s.maintainRatio},{default:d((()=>[p("保持宽高比")])),_:1},8,["onClick","checked"])])),_:1})])),_:1})])),_:1})):f("",!0),"percentage"===s.resizeMode?(g(),c(h,{key:1,class:"scale-input"},{default:d((()=>[m(l,null,{default:d((()=>[p("缩放比例: "+z(s.scale)+"%",1)])),_:1}),m(T,{value:s.scale,min:1,max:200,onChange:o.onScaleChange,"show-value":""},null,8,["value","onChange"])])),_:1})):f("",!0),m(j,{class:"primary-btn",onClick:o.resizeImage},{default:d((()=>[p("开始调整")])),_:1},8,["onClick"]),s.resizedPath?(g(),c(j,{key:2,class:"save-btn",onClick:o.saveImage},{default:d((()=>[p("保存图片")])),_:1},8,["onClick"])):f("",!0),m(j,{class:"reset-btn",onClick:o.resetImage},{default:d((()=>[p("重新选择")])),_:1},8,["onClick"])])),_:1})],64)):f("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-a72b3ccf"]]);export{B as default};
