import{g as e,p as t,q as a,u as i,s,v as o,x as l,y as r,z as c,c as n,w as h,d,i as m,o as u,e as g,f,k as v,j as p,t as w,F as _,r as F,l as P,A as y,C,B as k,D as b,E as x,G as I}from"./index-eabyWfXW.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=z({data:()=>({currentTheme:e("theme")||"light",imagePath:"",convertedPath:"",originalFormat:"",targetFormat:"png",quality:90,originalSize:"",convertedSize:"",imageWidth:0,imageHeight:0,supportedFormats:[{label:"PNG",value:"png"},{label:"JPEG",value:"jpeg"},{label:"WebP",value:"webp"},{label:"GIF",value:"gif"}]}),computed:{showQualityControl(){return!["png","gif"].includes(this.targetFormat)}},methods:{goBack(){t()},chooseImage(){a({count:1,success:e=>{i({filePath:e.tempFilePaths[0],success:t=>{t.size>20971520?s({title:"图片不能超过20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.convertedPath="",this.getImageInfo(e.tempFilePaths[0]))}})}})},async getImageInfo(e){try{const[t,a]=await Promise.all([i({filePath:e}),o({src:e})]);this.originalSize=this.formatFileSize(t.size),this.imageWidth=a.width,this.imageHeight=a.height,this.originalFormat=a.type||e.split(".").pop().toLowerCase()}catch(t){s({title:"获取图片信息失败",icon:"none"})}},previewImage(e){l({urls:[e],current:e})},resetImage(){this.imagePath="",this.convertedPath="",this.originalSize="",this.convertedSize="",this.imageWidth=0,this.imageHeight=0,this.$nextTick((()=>{this.chooseImage()}))},formatFileSize:e=>e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB",onFormatChange(e){this.targetFormat=e.detail.value},onQualityChange(e){this.quality=e.detail.value},async convertFormat(){if(this.imagePath)if(this.targetFormat!==this.originalFormat.toLowerCase()){r({title:"转换中..."});try{const e=await this.convertImageFormat(this.imagePath),t=await this.base64ToPath(e),a=await i({filePath:t});this.convertedPath=t,this.convertedSize=this.formatFileSize(a.size),c(),s({title:"转换成功",icon:"success"})}catch(e){console.error("转换失败:",e),c(),s({title:"转换失败",icon:"error"})}}else s({title:"请选择不同的格式",icon:"none"})},convertImageFormat(e){return new Promise(((t,a)=>{o({src:e,success:i=>{const s=document.createElement("canvas"),o=s.getContext("2d"),l=new Image;l.onload=()=>{s.width=i.width,s.height=i.height,o.drawImage(l,0,0,i.width,i.height);const e=`image/${this.targetFormat}`,a=this.showQualityControl?this.quality/100:void 0,r=s.toDataURL(e,a);t(r)},l.onerror=a,l.src=e},fail:a})}))},base64ToPath:e=>new Promise(((t,a)=>{const[,i,s]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!i||!s)return void a(new Error("base64 格式错误"));const o=atob(s),l=new Uint8Array(o.length);for(let e=0;e<o.length;e++)l[e]=o.charCodeAt(e);const r=new Blob([l],{type:"image/"+i});t(URL.createObjectURL(r))})),saveImage(){try{const e=document.createElement("a");e.href=this.convertedPath;const t=(new Date).getTime();e.download=`converted_image_${t}.${this.targetFormat}`,document.body.appendChild(e),e.click(),document.body.removeChild(e),s({title:"开始下载",icon:"success"})}catch(e){console.error("保存失败:",e),s({title:"保存失败",icon:"error"})}}},onShow(){this.currentTheme=e("theme")||"light"}},[["render",function(e,t,a,i,s,o){const l=P,r=m,c=y,z=x,S=I,B=C,q=k,T=b;return u(),n(r,{class:d(["container",s.currentTheme])},{default:h((()=>[g(r,{class:"header-fixed"},{default:h((()=>[g(r,{class:"back-btn",onClick:o.goBack},{default:h((()=>[g(l,{class:"back-icon"},{default:h((()=>[f("←")])),_:1})])),_:1},8,["onClick"]),g(l,{class:"title"},{default:h((()=>[f("格式转换")])),_:1})])),_:1}),g(r,{class:"header-placeholder"}),g(r,{class:"content"},{default:h((()=>[s.imagePath?v("",!0):(u(),n(r,{key:0,class:"upload-box",onClick:o.chooseImage},{default:h((()=>[g(l,{class:"upload-icon"},{default:h((()=>[f("📤")])),_:1}),g(l,{class:"upload-text"},{default:h((()=>[f("点击选择图片")])),_:1}),g(l,{class:"upload-tip"},{default:h((()=>[f("支持jpg、png、webp、gif格式，最大20MB")])),_:1})])),_:1},8,["onClick"])),s.imagePath?(u(),p(_,{key:1},[g(r,{class:"image-info"},{default:h((()=>[g(l,{class:"info-text"},{default:h((()=>[f("原始格式: "+w(s.originalFormat),1)])),_:1}),g(l,{class:"info-text"},{default:h((()=>[f("原始大小: "+w(s.originalSize),1)])),_:1}),g(l,{class:"info-text"},{default:h((()=>[f("图片尺寸: "+w(s.imageWidth)+" x "+w(s.imageHeight),1)])),_:1}),s.convertedSize?(u(),n(l,{key:0,class:"info-text"},{default:h((()=>[f("转换后大小: "+w(s.convertedSize),1)])),_:1})):v("",!0)])),_:1}),g(r,{class:"preview-container"},{default:h((()=>[g(r,{class:"preview-box"},{default:h((()=>[g(l,{class:"preview-title"},{default:h((()=>[f("原图")])),_:1}),g(c,{src:s.imagePath,mode:"aspectFit",class:"preview-image",onClick:t[0]||(t[0]=e=>o.previewImage(s.imagePath))},null,8,["src"])])),_:1}),s.convertedPath?(u(),n(r,{key:0,class:"preview-box"},{default:h((()=>[g(l,{class:"preview-title"},{default:h((()=>[f("转换后")])),_:1}),g(c,{src:s.convertedPath,mode:"aspectFit",class:"preview-image",onClick:t[1]||(t[1]=e=>o.previewImage(s.convertedPath))},null,8,["src"])])),_:1})):v("",!0)])),_:1}),g(r,{class:"control-panel"},{default:h((()=>[g(r,{class:"format-selector"},{default:h((()=>[g(l,{class:"format-title"},{default:h((()=>[f("目标格式:")])),_:1}),g(B,{class:"format-group",onChange:o.onFormatChange},{default:h((()=>[(u(!0),p(_,null,F(s.supportedFormats,(e=>(u(),n(S,{class:"format-item",key:e.value},{default:h((()=>[g(z,{value:e.value,checked:s.targetFormat===e.value},null,8,["value","checked"]),g(l,null,{default:h((()=>[f(w(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),o.showQualityControl?(u(),n(r,{key:0,class:"quality-control"},{default:h((()=>[g(l,{class:"quality-text"},{default:h((()=>[f("转换质量: "+w(s.quality)+"%",1)])),_:1}),g(q,{value:s.quality,min:1,max:100,onChange:o.onQualityChange,"show-value":"","block-color":"#007AFF"},null,8,["value","onChange"])])),_:1})):v("",!0),g(T,{class:"primary-btn",onClick:o.convertFormat},{default:h((()=>[f("开始转换")])),_:1},8,["onClick"]),s.convertedPath?(u(),n(T,{key:1,class:"save-btn",onClick:o.saveImage},{default:h((()=>[f("保存图片")])),_:1},8,["onClick"])):v("",!0),g(T,{class:"reset-btn",onClick:o.resetImage},{default:h((()=>[f("重新选择")])),_:1},8,["onClick"])])),_:1})],64)):v("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-8e7df7d3"]]);export{S as default};
