import{g as e,p as a,q as t,u as s,s as i,v as o,x as l,y as c,z as r,c as n,w as m,d as h,i as u,o as d,e as g,f as p,k as f,j as w,t as _,F as P,r as v,l as k,A as b,B as y,C,D as F,E as x,G as I}from"./index.JjN5nCoJ.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=z({data:()=>({imagePath:"",compressedPath:"",quality:80,originalSize:"",compressedSize:"",compressionRatio:0,imageWidth:0,imageHeight:0,originalFormat:"",outputFormat:"jpeg",supportedFormats:[{label:"JPEG",value:"jpeg"},{label:"PNG",value:"png"},{label:"WebP",value:"webp"}],currentTheme:e("theme")||"light"}),methods:{goBack(){a()},chooseImage(){t({count:1,success:e=>{s({filePath:e.tempFilePaths[0],success:a=>{a.size>20971520?i({title:"å›¾ç‰‡ä¸èƒ½è¶…è¿‡20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.compressedPath="",this.getImageInfo(e.tempFilePaths[0]))}})}})},async getImageInfo(e){try{const[a,t]=await Promise.all([s({filePath:e}),o({src:e})]);this.originalSize=this.formatFileSize(a.size),this.imageWidth=t.width,this.imageHeight=t.height,this.originalFormat=t.type||e.split(".").pop().toLowerCase(),this.outputFormat=this.originalFormat.toLowerCase()}catch(a){i({title:"è·å–å›¾ç‰‡ä¿¡æ¯å¤±è´¥",icon:"none"})}},previewImage(e){l({urls:[e],current:e})},resetImage(){this.imagePath="",this.compressedPath="",this.originalSize="",this.compressedSize="",this.compressionRatio=0,this.imageWidth=0,this.imageHeight=0,this.$nextTick((()=>{this.chooseImage()}))},formatFileSize:e=>e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB",onQualityChange(e){this.quality=e.detail.value},onFormatChange(e){this.outputFormat=e.detail.value},async compressImage(){if(this.imagePath){c({title:"å‹ç¼©ä¸­..."});try{const e=await new Promise(((e,a)=>{s({filePath:this.imagePath,success:e,fail:a})})),a=await this.compressImageByCanvas(this.imagePath,this.quality),t=await this.base64ToPath(a),o=await new Promise(((e,a)=>{s({filePath:t,success:e,fail:a})}));this.compressedPath=t,this.compressedSize=this.formatFileSize(o.size),this.compressionRatio=((e.size-o.size)/e.size*100).toFixed(1),r(),i({title:"å‹ç¼©æˆåŠŸ",icon:"success"})}catch(e){console.error("å‹ç¼©å¤±è´¥:",e),r(),i({title:"å‹ç¼©å¤±è´¥",icon:"error"})}}},compressImageByCanvas(e,a){return new Promise(((t,s)=>{o({src:e,success:i=>{const o=document.createElement("canvas"),l=o.getContext("2d"),c=new Image;c.onload=()=>{o.width=i.width,o.height=i.height,l.drawImage(c,0,0,i.width,i.height);let e="image/jpeg";switch(this.outputFormat){case"png":e="image/png";break;case"webp":e="image/webp"}const s="png"===this.outputFormat?o.toDataURL(e):o.toDataURL(e,a/100);t(s)},c.onerror=s,c.src=e},fail:s})}))},base64ToPath:e=>new Promise(((a,t)=>{const[,s,i]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!s||!i)return void t(new Error("base64 æ ¼å¼é”™è¯¯"));const o=atob(i),l=new Uint8Array(o.length);for(let e=0;e<o.length;e++)l[e]=o.charCodeAt(e);const c=new Blob([l],{type:"image/"+s});a(URL.createObjectURL(c))})),saveImage(){try{const e=document.createElement("a");e.href=this.compressedPath;const a=(new Date).getTime();e.download=`compressed_image_${a}.${this.outputFormat}`,document.body.appendChild(e),e.click(),document.body.removeChild(e),i({title:"å¼€å§‹ä¸‹è½½",icon:"success"})}catch(e){console.error("ä¿å­˜å¤±è´¥:",e),i({title:"ä¿å­˜å¤±è´¥",icon:"error"})}}},onShow(){this.currentTheme=e("theme")||"light"}},[["render",function(e,a,t,s,i,o){const l=k,c=u,r=b,z=y,S=x,B=I,j=C,R=F;return d(),n(c,{class:h(["container",i.currentTheme])},{default:m((()=>[g(c,{class:"header-fixed"},{default:m((()=>[g(c,{class:"back-btn",onClick:o.goBack},{default:m((()=>[g(l,{class:"back-icon"},{default:m((()=>[p("â†")])),_:1})])),_:1},8,["onClick"]),g(l,{class:"title"},{default:m((()=>[p("å›¾ç‰‡å‹ç¼©")])),_:1})])),_:1}),g(c,{class:"header-placeholder"}),g(c,{class:"content"},{default:m((()=>[i.imagePath?f("",!0):(d(),n(c,{key:0,class:"upload-box",onClick:o.chooseImage},{default:m((()=>[g(l,{class:"upload-icon"},{default:m((()=>[p("ğŸ“¤")])),_:1}),g(l,{class:"upload-text"},{default:m((()=>[p("ç‚¹å‡»é€‰æ‹©å›¾ç‰‡")])),_:1}),g(l,{class:"upload-tip"},{default:m((()=>[p("æ”¯æŒjpgã€pngæ ¼å¼ï¼Œæœ€å¤§20MB")])),_:1})])),_:1},8,["onClick"])),i.imagePath?(d(),w(P,{key:1},[g(c,{class:"image-info"},{default:m((()=>[g(l,{class:"info-text"},{default:m((()=>[p("åŸå§‹å¤§å°: "+_(i.originalSize),1)])),_:1}),g(l,{class:"info-text"},{default:m((()=>[p("åŸå§‹æ ¼å¼: "+_(i.originalFormat),1)])),_:1}),i.compressedSize?(d(),n(l,{key:0,class:"info-text"},{default:m((()=>[p("å‹ç¼©å: "+_(i.compressedSize),1)])),_:1})):f("",!0),i.compressedSize?(d(),n(l,{key:1,class:"info-text"},{default:m((()=>[p("å‹ç¼©ç‡: "+_(i.compressionRatio)+"%",1)])),_:1})):f("",!0),g(l,{class:"info-text"},{default:m((()=>[p("å›¾ç‰‡å°ºå¯¸: "+_(i.imageWidth)+" x "+_(i.imageHeight),1)])),_:1})])),_:1}),g(c,{class:"preview-container"},{default:m((()=>[g(c,{class:"preview-box"},{default:m((()=>[g(l,{class:"preview-title"},{default:m((()=>[p("åŸå›¾")])),_:1}),g(r,{src:i.imagePath,mode:"aspectFit",class:"preview-image",onClick:a[0]||(a[0]=e=>o.previewImage(i.imagePath))},null,8,["src"])])),_:1}),i.compressedPath?(d(),n(c,{key:0,class:"preview-box"},{default:m((()=>[g(l,{class:"preview-title"},{default:m((()=>[p("å‹ç¼©å")])),_:1}),g(r,{src:i.compressedPath,mode:"aspectFit",class:"preview-image",onClick:a[1]||(a[1]=e=>o.previewImage(i.compressedPath))},null,8,["src"])])),_:1})):f("",!0)])),_:1}),g(c,{class:"control-panel"},{default:m((()=>[g(l,{class:"quality-text"},{default:m((()=>[p("å‹ç¼©è´¨é‡: "+_(i.quality)+"%",1)])),_:1}),g(z,{value:i.quality,min:1,max:100,onChange:o.onQualityChange,"show-value":"","block-color":"#007AFF"},null,8,["value","onChange"]),g(c,{class:"format-selector"},{default:m((()=>[g(l,{class:"format-title"},{default:m((()=>[p("è¾“å‡ºæ ¼å¼:")])),_:1}),g(j,{class:"format-group",onChange:o.onFormatChange},{default:m((()=>[(d(!0),w(P,null,v(i.supportedFormats,(e=>(d(),n(B,{class:"format-item",key:e.value},{default:m((()=>[g(S,{value:e.value,checked:i.outputFormat===e.value},null,8,["value","checked"]),g(l,null,{default:m((()=>[p(_(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),g(R,{class:"primary-btn",onClick:o.compressImage},{default:m((()=>[p("å¼€å§‹å‹ç¼©")])),_:1},8,["onClick"]),i.compressedPath?(d(),n(R,{key:0,class:"save-btn",onClick:o.saveImage},{default:m((()=>[p("ä¿å­˜å›¾ç‰‡")])),_:1},8,["onClick"])):f("",!0),g(R,{class:"reset-btn",onClick:o.resetImage},{default:m((()=>[p("é‡æ–°é€‰æ‹©")])),_:1},8,["onClick"])])),_:1})],64)):f("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-78ba0d02"]]);export{S as default};
