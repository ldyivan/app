import{g as e,p as a,q as t,u as s,s as i,v as o,x as l,y as c,z as r,c as n,w as m,d as h,i as u,o as d,e as g,f as p,k as f,j as w,t as _,F as P,r as v,l as k,A as b,B as y,C,D as F,E as x,G as I}from"./index.JjN5nCoJ.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=z({data:()=>({imagePath:"",compressedPath:"",quality:80,originalSize:"",compressedSize:"",compressionRatio:0,imageWidth:0,imageHeight:0,originalFormat:"",outputFormat:"jpeg",supportedFormats:[{label:"JPEG",value:"jpeg"},{label:"PNG",value:"png"},{label:"WebP",value:"webp"}],currentTheme:e("theme")||"light"}),methods:{goBack(){a()},chooseImage(){t({count:1,success:e=>{s({filePath:e.tempFilePaths[0],success:a=>{a.size>20971520?i({title:"图片不能超过20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.compressedPath="",this.getImageInfo(e.tempFilePaths[0]))}})}})},async getImageInfo(e){try{const[a,t]=await Promise.all([s({filePath:e}),o({src:e})]);this.originalSize=this.formatFileSize(a.size),this.imageWidth=t.width,this.imageHeight=t.height,this.originalFormat=t.type||e.split(".").pop().toLowerCase(),this.outputFormat=this.originalFormat.toLowerCase()}catch(a){i({title:"获取图片信息失败",icon:"none"})}},previewImage(e){l({urls:[e],current:e})},resetImage(){this.imagePath="",this.compressedPath="",this.originalSize="",this.compressedSize="",this.compressionRatio=0,this.imageWidth=0,this.imageHeight=0,this.$nextTick((()=>{this.chooseImage()}))},formatFileSize:e=>e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB",onQualityChange(e){this.quality=e.detail.value},onFormatChange(e){this.outputFormat=e.detail.value},async compressImage(){if(this.imagePath){c({title:"压缩中..."});try{const e=await new Promise(((e,a)=>{s({filePath:this.imagePath,success:e,fail:a})})),a=await this.compressImageByCanvas(this.imagePath,this.quality),t=await this.base64ToPath(a),o=await new Promise(((e,a)=>{s({filePath:t,success:e,fail:a})}));this.compressedPath=t,this.compressedSize=this.formatFileSize(o.size),this.compressionRatio=((e.size-o.size)/e.size*100).toFixed(1),r(),i({title:"压缩成功",icon:"success"})}catch(e){console.error("压缩失败:",e),r(),i({title:"压缩失败",icon:"error"})}}},compressImageByCanvas(e,a){return new Promise(((t,s)=>{o({src:e,success:i=>{const o=document.createElement("canvas"),l=o.getContext("2d"),c=new Image;c.onload=()=>{o.width=i.width,o.height=i.height,l.drawImage(c,0,0,i.width,i.height);let e="image/jpeg";switch(this.outputFormat){case"png":e="image/png";break;case"webp":e="image/webp"}const s="png"===this.outputFormat?o.toDataURL(e):o.toDataURL(e,a/100);t(s)},c.onerror=s,c.src=e},fail:s})}))},base64ToPath:e=>new Promise(((a,t)=>{const[,s,i]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!s||!i)return void t(new Error("base64 格式错误"));const o=atob(i),l=new Uint8Array(o.length);for(let e=0;e<o.length;e++)l[e]=o.charCodeAt(e);const c=new Blob([l],{type:"image/"+s});a(URL.createObjectURL(c))})),saveImage(){try{const e=document.createElement("a");e.href=this.compressedPath;const a=(new Date).getTime();e.download=`compressed_image_${a}.${this.outputFormat}`,document.body.appendChild(e),e.click(),document.body.removeChild(e),i({title:"开始下载",icon:"success"})}catch(e){console.error("保存失败:",e),i({title:"保存失败",icon:"error"})}}},onShow(){this.currentTheme=e("theme")||"light"}},[["render",function(e,a,t,s,i,o){const l=k,c=u,r=b,z=y,S=x,B=I,j=C,R=F;return d(),n(c,{class:h(["container",i.currentTheme])},{default:m((()=>[g(c,{class:"header-fixed"},{default:m((()=>[g(c,{class:"back-btn",onClick:o.goBack},{default:m((()=>[g(l,{class:"back-icon"},{default:m((()=>[p("←")])),_:1})])),_:1},8,["onClick"]),g(l,{class:"title"},{default:m((()=>[p("图片压缩")])),_:1})])),_:1}),g(c,{class:"header-placeholder"}),g(c,{class:"content"},{default:m((()=>[i.imagePath?f("",!0):(d(),n(c,{key:0,class:"upload-box",onClick:o.chooseImage},{default:m((()=>[g(l,{class:"upload-icon"},{default:m((()=>[p("📤")])),_:1}),g(l,{class:"upload-text"},{default:m((()=>[p("点击选择图片")])),_:1}),g(l,{class:"upload-tip"},{default:m((()=>[p("支持jpg、png格式，最大20MB")])),_:1})])),_:1},8,["onClick"])),i.imagePath?(d(),w(P,{key:1},[g(c,{class:"image-info"},{default:m((()=>[g(l,{class:"info-text"},{default:m((()=>[p("原始大小: "+_(i.originalSize),1)])),_:1}),g(l,{class:"info-text"},{default:m((()=>[p("原始格式: "+_(i.originalFormat),1)])),_:1}),i.compressedSize?(d(),n(l,{key:0,class:"info-text"},{default:m((()=>[p("压缩后: "+_(i.compressedSize),1)])),_:1})):f("",!0),i.compressedSize?(d(),n(l,{key:1,class:"info-text"},{default:m((()=>[p("压缩率: "+_(i.compressionRatio)+"%",1)])),_:1})):f("",!0),g(l,{class:"info-text"},{default:m((()=>[p("图片尺寸: "+_(i.imageWidth)+" x "+_(i.imageHeight),1)])),_:1})])),_:1}),g(c,{class:"preview-container"},{default:m((()=>[g(c,{class:"preview-box"},{default:m((()=>[g(l,{class:"preview-title"},{default:m((()=>[p("原图")])),_:1}),g(r,{src:i.imagePath,mode:"aspectFit",class:"preview-image",onClick:a[0]||(a[0]=e=>o.previewImage(i.imagePath))},null,8,["src"])])),_:1}),i.compressedPath?(d(),n(c,{key:0,class:"preview-box"},{default:m((()=>[g(l,{class:"preview-title"},{default:m((()=>[p("压缩后")])),_:1}),g(r,{src:i.compressedPath,mode:"aspectFit",class:"preview-image",onClick:a[1]||(a[1]=e=>o.previewImage(i.compressedPath))},null,8,["src"])])),_:1})):f("",!0)])),_:1}),g(c,{class:"control-panel"},{default:m((()=>[g(l,{class:"quality-text"},{default:m((()=>[p("压缩质量: "+_(i.quality)+"%",1)])),_:1}),g(z,{value:i.quality,min:1,max:100,onChange:o.onQualityChange,"show-value":"","block-color":"#007AFF"},null,8,["value","onChange"]),g(c,{class:"format-selector"},{default:m((()=>[g(l,{class:"format-title"},{default:m((()=>[p("输出格式:")])),_:1}),g(j,{class:"format-group",onChange:o.onFormatChange},{default:m((()=>[(d(!0),w(P,null,v(i.supportedFormats,(e=>(d(),n(B,{class:"format-item",key:e.value},{default:m((()=>[g(S,{value:e.value,checked:i.outputFormat===e.value},null,8,["value","checked"]),g(l,null,{default:m((()=>[p(_(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),g(R,{class:"primary-btn",onClick:o.compressImage},{default:m((()=>[p("开始压缩")])),_:1},8,["onClick"]),i.compressedPath?(d(),n(R,{key:0,class:"save-btn",onClick:o.saveImage},{default:m((()=>[p("保存图片")])),_:1},8,["onClick"])):f("",!0),g(R,{class:"reset-btn",onClick:o.resetImage},{default:m((()=>[p("重新选择")])),_:1},8,["onClick"])])),_:1})],64)):f("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-78ba0d02"]]);export{S as default};
