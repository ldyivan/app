import{h as e,C as t,D as a,E as i,j as s,G as l,I as h,J as n,H as o,a as c,w as d,m as r,p as u,o as g,c as m,q as p,y as f,v as z,B as w,F as _,x as v,z as k,K as C,P,M as I,Q as b,R as y,L as x,N as M,O as S}from"./vendor.CUmXYvjV.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=R({data:()=>({imagePath:"",resizedPath:"",originalWidth:0,originalHeight:0,width:0,height:0,originalSize:"",resizedSize:"",maintainRatio:!0,aspectRatio:1,scale:100,resizeMode:"percentage",resizeModes:[{label:"æŒ‰ç™¾åˆ†æ¯”",value:"percentage"},{label:"è‡ªå®šä¹‰å°ºå¯¸",value:"custom"}],currentTheme:e("theme")||"light"}),methods:{goBack(){t()},chooseImage(){a({count:1,success:e=>{i({filePath:e.tempFilePaths[0],success:t=>{t.size>20971520?s({title:"å›¾ç‰‡ä¸èƒ½è¶…è¿‡20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.resizedPath="",this.getImageInfo(e.tempFilePaths[0]))}})}})},async getImageInfo(e){try{const[t,a]=await Promise.all([i({filePath:e}),l({src:e})]);this.originalSize=this.formatFileSize(t.size),this.originalWidth=a.width,this.originalHeight=a.height,this.width=a.width,this.height=a.height,this.aspectRatio=a.width/a.height}catch(t){s({title:"è·å–å›¾ç‰‡ä¿¡æ¯å¤±è´¥",icon:"none"})}},onModeChange(e){this.resizeMode=e.detail.value,"percentage"===this.resizeMode?(this.scale=100,this.updateSizeByScale()):(this.width=this.originalWidth,this.height=this.originalHeight)},onWidthInput(e){const t=Number(e.detail.value)||0;if(this.width=t,"custom"===this.resizeMode&&this.maintainRatio&&t>0){const e=Math.round(t/this.aspectRatio);this.height=e}},onHeightInput(e){const t=Number(e.detail.value)||0;if(this.height=t,"custom"===this.resizeMode&&this.maintainRatio&&t>0){const e=Math.round(t*this.aspectRatio);this.width=e}},onRatioChange(e){if(this.maintainRatio=!this.maintainRatio,this.maintainRatio&&this.width>0){const e=Math.round(this.width/this.aspectRatio);this.height=e}},onScaleChange(e){this.scale=e.detail.value,this.updateSizeByScale()},updateSizeByScale(){this.width=Math.round(this.originalWidth*this.scale/100),this.height=Math.round(this.originalHeight*this.scale/100)},async resizeImage(){if(this.imagePath)if(this.width<=0||this.height<=0)s({title:"å°ºå¯¸å¿…é¡»å¤§äº0",icon:"none"});else{h({title:"å¤„ç†ä¸­..."});try{const e=await this.resizeImageByCanvas(),t=await this.base64ToPath(e),a=await i({filePath:t});this.resizedPath=t,this.resizedSize=this.formatFileSize(a.size),n(),s({title:"è°ƒæ•´æˆåŠŸ",icon:"success"})}catch(e){n(),s({title:"è°ƒæ•´å¤±è´¥",icon:"error"})}}},resizeImageByCanvas(){return new Promise(((e,t)=>{const a=new Image;a.onload=()=>{const t=document.createElement("canvas"),i=t.getContext("2d");t.width=this.width,t.height=this.height,i.drawImage(a,0,0,this.width,this.height),e(t.toDataURL("image/png"))},a.onerror=t,a.src=this.imagePath}))},formatFileSize:e=>e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB",base64ToPath:e=>new Promise(((t,a)=>{const[,i,s]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!i||!s)return void a(new Error("base64 æ ¼å¼é”™è¯¯"));const l=atob(s),h=new Uint8Array(l.length);for(let e=0;e<l.length;e++)h[e]=l.charCodeAt(e);const n=new Blob([h],{type:"image/png"});t(URL.createObjectURL(n))})),previewImage(e){o({urls:[e],current:e})},resetImage(){this.imagePath="",this.resizedPath="",this.originalSize="",this.resizedSize="",this.width=0,this.height=0,this.scale=100,this.$nextTick((()=>{this.chooseImage()}))},saveImage(){try{const e=document.createElement("a");e.href=this.resizedPath;const t=(new Date).getTime();e.download=`resized_image_${t}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),s({title:"å¼€å§‹ä¸‹è½½",icon:"success"})}catch(e){s({title:"ä¿å­˜å¤±è´¥",icon:"error"})}}},onShow(){this.currentTheme=e("theme")||"light"}},[["render",function(e,t,a,i,s,l){const h=k,n=u,o=C,R=S,B=P,F=I,H=b,T=y,W=x,j=M;return g(),c(n,{class:r(["container",s.currentTheme])},{default:d((()=>[m(n,{class:"header-fixed"},{default:d((()=>[m(n,{class:"back-btn",onClick:l.goBack},{default:d((()=>[m(h,{class:"back-icon"},{default:d((()=>[p("â†")])),_:1})])),_:1},8,["onClick"]),m(h,{class:"title"},{default:d((()=>[p("å›¾ç‰‡ç¼©æ”¾")])),_:1})])),_:1}),m(n,{class:"header-placeholder"}),m(n,{class:"content"},{default:d((()=>[s.imagePath?f("",!0):(g(),c(n,{key:0,class:"upload-box",onClick:l.chooseImage},{default:d((()=>[m(h,{class:"upload-icon"},{default:d((()=>[p("ğŸ“¤")])),_:1}),m(h,{class:"upload-text"},{default:d((()=>[p("ç‚¹å‡»é€‰æ‹©å›¾ç‰‡")])),_:1}),m(h,{class:"upload-tip"},{default:d((()=>[p("æ”¯æŒjpgã€pngã€webpæ ¼å¼ï¼Œæœ€å¤§20MB")])),_:1})])),_:1},8,["onClick"])),s.imagePath?(g(),z(_,{key:1},[m(n,{class:"image-info"},{default:d((()=>[m(h,{class:"info-text"},{default:d((()=>[p("åŸå§‹å°ºå¯¸: "+w(s.originalWidth)+" x "+w(s.originalHeight),1)])),_:1}),m(h,{class:"info-text"},{default:d((()=>[p("åŸå§‹å¤§å°: "+w(s.originalSize),1)])),_:1}),s.resizedPath?(g(),c(h,{key:0,class:"info-text"},{default:d((()=>[p("è°ƒæ•´åå°ºå¯¸: "+w(s.width)+" x "+w(s.height),1)])),_:1})):f("",!0),s.resizedSize?(g(),c(h,{key:1,class:"info-text"},{default:d((()=>[p("è°ƒæ•´åå¤§å°: "+w(s.resizedSize),1)])),_:1})):f("",!0)])),_:1}),m(n,{class:"preview-container"},{default:d((()=>[m(n,{class:"preview-box"},{default:d((()=>[m(h,{class:"preview-title"},{default:d((()=>[p("åŸå›¾")])),_:1}),m(o,{src:s.imagePath,mode:"aspectFit",class:"preview-image",onClick:t[0]||(t[0]=e=>l.previewImage(s.imagePath))},null,8,["src"])])),_:1}),s.resizedPath?(g(),c(n,{key:0,class:"preview-box"},{default:d((()=>[m(h,{class:"preview-title"},{default:d((()=>[p("è°ƒæ•´å")])),_:1}),m(o,{src:s.resizedPath,mode:"aspectFit",class:"preview-image",onClick:t[1]||(t[1]=e=>l.previewImage(s.resizedPath))},null,8,["src"])])),_:1})):f("",!0)])),_:1}),m(n,{class:"control-panel"},{default:d((()=>[m(n,{class:"resize-mode"},{default:d((()=>[m(h,{class:"mode-title"},{default:d((()=>[p("ç¼©æ”¾æ¨¡å¼:")])),_:1}),m(F,{class:"mode-group",onChange:l.onModeChange},{default:d((()=>[(g(!0),z(_,null,v(s.resizeModes,(e=>(g(),c(B,{class:"mode-item",key:e.value},{default:d((()=>[m(R,{value:e.value,checked:s.resizeMode===e.value},null,8,["value","checked"]),m(h,null,{default:d((()=>[p(w(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),"custom"===s.resizeMode?(g(),c(n,{key:0,class:"size-inputs"},{default:d((()=>[m(n,{class:"input-group"},{default:d((()=>[m(h,null,{default:d((()=>[p("å®½åº¦ (px)")])),_:1}),m(H,{type:"number",value:s.width,placeholder:"è¾“å…¥å®½åº¦",onInput:l.onWidthInput},null,8,["value","onInput"])])),_:1}),m(n,{class:"input-group"},{default:d((()=>[m(h,null,{default:d((()=>[p("é«˜åº¦ (px)")])),_:1}),m(H,{type:"number",value:s.height,placeholder:"è¾“å…¥é«˜åº¦",onInput:l.onHeightInput},null,8,["value","onInput"])])),_:1}),m(n,{class:"ratio-lock"},{default:d((()=>[m(B,null,{default:d((()=>[m(T,{onClick:l.onRatioChange,checked:s.maintainRatio},{default:d((()=>[p("ä¿æŒå®½é«˜æ¯”")])),_:1},8,["onClick","checked"])])),_:1})])),_:1})])),_:1})):f("",!0),"percentage"===s.resizeMode?(g(),c(n,{key:1,class:"scale-input"},{default:d((()=>[m(h,null,{default:d((()=>[p("ç¼©æ”¾æ¯”ä¾‹: "+w(s.scale)+"%",1)])),_:1}),m(W,{value:s.scale,min:1,max:200,onChange:l.onScaleChange,"show-value":""},null,8,["value","onChange"])])),_:1})):f("",!0),m(j,{class:"primary-btn",onClick:l.resizeImage},{default:d((()=>[p("å¼€å§‹è°ƒæ•´")])),_:1},8,["onClick"]),s.resizedPath?(g(),c(j,{key:2,class:"save-btn",onClick:l.saveImage},{default:d((()=>[p("ä¿å­˜å›¾ç‰‡")])),_:1},8,["onClick"])):f("",!0),m(j,{class:"reset-btn",onClick:l.resetImage},{default:d((()=>[p("é‡æ–°é€‰æ‹©")])),_:1},8,["onClick"])])),_:1})],64)):f("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-a72b3ccf"]]);export{B as default};
