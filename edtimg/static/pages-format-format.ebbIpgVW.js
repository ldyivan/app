import{h as e,C as t,D as a,E as i,j as s,G as o,H as l,I as c,J as n,a as r,w as h,m as d,p as m,o as u,c as g,q as f,y as v,v as p,B as w,F as _,x as F,z as P,K as y,M as C,L as k,N as b,O as I,P as x}from"./vendor.CUmXYvjV.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=z({data:()=>({currentTheme:e("theme")||"light",imagePath:"",convertedPath:"",originalFormat:"",targetFormat:"png",quality:90,originalSize:"",convertedSize:"",imageWidth:0,imageHeight:0,supportedFormats:[{label:"PNG",value:"png"},{label:"JPEG",value:"jpeg"},{label:"WebP",value:"webp"},{label:"GIF",value:"gif"}]}),computed:{showQualityControl(){return!["png","gif"].includes(this.targetFormat)}},methods:{goBack(){t()},chooseImage(){a({count:1,success:e=>{i({filePath:e.tempFilePaths[0],success:t=>{t.size>20971520?s({title:"å›¾ç‰‡ä¸èƒ½è¶…è¿‡20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.convertedPath="",this.getImageInfo(e.tempFilePaths[0]))}})}})},async getImageInfo(e){try{const[t,a]=await Promise.all([i({filePath:e}),o({src:e})]);this.originalSize=this.formatFileSize(t.size),this.imageWidth=a.width,this.imageHeight=a.height,this.originalFormat=a.type||e.split(".").pop().toLowerCase()}catch(t){s({title:"è·å–å›¾ç‰‡ä¿¡æ¯å¤±è´¥",icon:"none"})}},previewImage(e){l({urls:[e],current:e})},resetImage(){this.imagePath="",this.convertedPath="",this.originalSize="",this.convertedSize="",this.imageWidth=0,this.imageHeight=0,this.$nextTick((()=>{this.chooseImage()}))},formatFileSize:e=>e<1024?e+"B":e<1048576?(e/1024).toFixed(2)+"KB":(e/1024/1024).toFixed(2)+"MB",onFormatChange(e){this.targetFormat=e.detail.value},onQualityChange(e){this.quality=e.detail.value},async convertFormat(){if(this.imagePath)if(this.targetFormat!==this.originalFormat.toLowerCase()){c({title:"è½¬æ¢ä¸­..."});try{const e=await this.convertImageFormat(this.imagePath),t=await this.base64ToPath(e),a=await i({filePath:t});this.convertedPath=t,this.convertedSize=this.formatFileSize(a.size),n(),s({title:"è½¬æ¢æˆåŠŸ",icon:"success"})}catch(e){n(),s({title:"è½¬æ¢å¤±è´¥",icon:"error"})}}else s({title:"è¯·é€‰æ‹©ä¸åŒçš„æ ¼å¼",icon:"none"})},convertImageFormat(e){return new Promise(((t,a)=>{o({src:e,success:i=>{const s=document.createElement("canvas"),o=s.getContext("2d"),l=new Image;l.onload=()=>{s.width=i.width,s.height=i.height,o.drawImage(l,0,0,i.width,i.height);const e=`image/${this.targetFormat}`,a=this.showQualityControl?this.quality/100:void 0,c=s.toDataURL(e,a);t(c)},l.onerror=a,l.src=e},fail:a})}))},base64ToPath:e=>new Promise(((t,a)=>{const[,i,s]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!i||!s)return void a(new Error("base64 æ ¼å¼é”™è¯¯"));const o=atob(s),l=new Uint8Array(o.length);for(let e=0;e<o.length;e++)l[e]=o.charCodeAt(e);const c=new Blob([l],{type:"image/"+i});t(URL.createObjectURL(c))})),saveImage(){try{const e=document.createElement("a");e.href=this.convertedPath;const t=(new Date).getTime();e.download=`converted_image_${t}.${this.targetFormat}`,document.body.appendChild(e),e.click(),document.body.removeChild(e),s({title:"å¼€å§‹ä¸‹è½½",icon:"success"})}catch(e){s({title:"ä¿å­˜å¤±è´¥",icon:"error"})}}},onShow(){this.currentTheme=e("theme")||"light"}},[["render",function(e,t,a,i,s,o){const l=P,c=m,n=y,z=I,S=x,B=C,q=k,T=b;return u(),r(c,{class:d(["container",s.currentTheme])},{default:h((()=>[g(c,{class:"header-fixed"},{default:h((()=>[g(c,{class:"back-btn",onClick:o.goBack},{default:h((()=>[g(l,{class:"back-icon"},{default:h((()=>[f("â†")])),_:1})])),_:1},8,["onClick"]),g(l,{class:"title"},{default:h((()=>[f("æ ¼å¼è½¬æ¢")])),_:1})])),_:1}),g(c,{class:"header-placeholder"}),g(c,{class:"content"},{default:h((()=>[s.imagePath?v("",!0):(u(),r(c,{key:0,class:"upload-box",onClick:o.chooseImage},{default:h((()=>[g(l,{class:"upload-icon"},{default:h((()=>[f("ğŸ“¤")])),_:1}),g(l,{class:"upload-text"},{default:h((()=>[f("ç‚¹å‡»é€‰æ‹©å›¾ç‰‡")])),_:1}),g(l,{class:"upload-tip"},{default:h((()=>[f("æ”¯æŒjpgã€pngã€webpã€gifæ ¼å¼ï¼Œæœ€å¤§20MB")])),_:1})])),_:1},8,["onClick"])),s.imagePath?(u(),p(_,{key:1},[g(c,{class:"image-info"},{default:h((()=>[g(l,{class:"info-text"},{default:h((()=>[f("åŸå§‹æ ¼å¼: "+w(s.originalFormat),1)])),_:1}),g(l,{class:"info-text"},{default:h((()=>[f("åŸå§‹å¤§å°: "+w(s.originalSize),1)])),_:1}),g(l,{class:"info-text"},{default:h((()=>[f("å›¾ç‰‡å°ºå¯¸: "+w(s.imageWidth)+" x "+w(s.imageHeight),1)])),_:1}),s.convertedSize?(u(),r(l,{key:0,class:"info-text"},{default:h((()=>[f("è½¬æ¢åå¤§å°: "+w(s.convertedSize),1)])),_:1})):v("",!0)])),_:1}),g(c,{class:"preview-container"},{default:h((()=>[g(c,{class:"preview-box"},{default:h((()=>[g(l,{class:"preview-title"},{default:h((()=>[f("åŸå›¾")])),_:1}),g(n,{src:s.imagePath,mode:"aspectFit",class:"preview-image",onClick:t[0]||(t[0]=e=>o.previewImage(s.imagePath))},null,8,["src"])])),_:1}),s.convertedPath?(u(),r(c,{key:0,class:"preview-box"},{default:h((()=>[g(l,{class:"preview-title"},{default:h((()=>[f("è½¬æ¢å")])),_:1}),g(n,{src:s.convertedPath,mode:"aspectFit",class:"preview-image",onClick:t[1]||(t[1]=e=>o.previewImage(s.convertedPath))},null,8,["src"])])),_:1})):v("",!0)])),_:1}),g(c,{class:"control-panel"},{default:h((()=>[g(c,{class:"format-selector"},{default:h((()=>[g(l,{class:"format-title"},{default:h((()=>[f("ç›®æ ‡æ ¼å¼:")])),_:1}),g(B,{class:"format-group",onChange:o.onFormatChange},{default:h((()=>[(u(!0),p(_,null,F(s.supportedFormats,(e=>(u(),r(S,{class:"format-item",key:e.value},{default:h((()=>[g(z,{value:e.value,checked:s.targetFormat===e.value},null,8,["value","checked"]),g(l,null,{default:h((()=>[f(w(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),o.showQualityControl?(u(),r(c,{key:0,class:"quality-control"},{default:h((()=>[g(l,{class:"quality-text"},{default:h((()=>[f("è½¬æ¢è´¨é‡: "+w(s.quality)+"%",1)])),_:1}),g(q,{value:s.quality,min:1,max:100,onChange:o.onQualityChange,"show-value":"","block-color":"#007AFF"},null,8,["value","onChange"])])),_:1})):v("",!0),g(T,{class:"primary-btn",onClick:o.convertFormat},{default:h((()=>[f("å¼€å§‹è½¬æ¢")])),_:1},8,["onClick"]),s.convertedPath?(u(),r(T,{key:1,class:"save-btn",onClick:o.saveImage},{default:h((()=>[f("ä¿å­˜å›¾ç‰‡")])),_:1},8,["onClick"])):v("",!0),g(T,{class:"reset-btn",onClick:o.resetImage},{default:h((()=>[f("é‡æ–°é€‰æ‹©")])),_:1},8,["onClick"])])),_:1})],64)):v("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-8e7df7d3"]]);export{S as default};
