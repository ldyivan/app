import{h as e,C as a,D as t,E as s,j as o,S as c,I as l,J as r,a as i,w as n,m as p,p as h,o as d,c as u,q as g,y as m,v as f,T as b,F as _,x as k,z as v,M as C,N as P,K as y,B as w,O as R,P as x}from"./vendor.CUmXYvjV.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=I({data:()=>({currentTheme:e("theme")||"light",imagePath:"",croppedPath:"",cropper:null,selectedRatio:"free",ratios:[{label:"自由",value:"free"},{label:"1:1",value:"1:1"},{label:"4:3",value:"4:3"},{label:"16:9",value:"16:9"}]}),onShow(){this.currentTheme=e("theme")||"light"},methods:{goBack(){a()},chooseImage(){t({count:1,success:e=>{s({filePath:e.tempFilePaths[0],success:a=>{a.size>20971520?o({title:"图片不能超过20MB",icon:"none"}):(this.imagePath=e.tempFilePaths[0],this.croppedPath="",this.$nextTick((()=>{this.initCropper()})))}})}})},initCropper(){this.cropper&&this.cropper.destroy();const e=this.$refs.image;this.cropper=new c(e,{aspectRatio:NaN,viewMode:1,dragMode:"move",autoCropArea:1,restore:!1,modal:!0,guides:!0,highlight:!1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!1})},onRatioChange(e){this.selectedRatio=e.detail.value;let a=NaN;switch(this.selectedRatio){case"1:1":a=1;break;case"4:3":a=4/3;break;case"16:9":a=16/9}this.cropper.setAspectRatio(a)},cropImage(){l({title:"裁剪中..."});try{const e=this.cropper.getCroppedCanvas().toDataURL("image/png");this.base64ToPath(e).then((e=>{this.croppedPath=e,r(),o({title:"裁剪成功",icon:"success"})}))}catch(e){r(),o({title:"裁剪失败",icon:"error"})}},base64ToPath:e=>new Promise(((a,t)=>{const[,s,o]=/data:image\/(\w+);base64,(.*)/.exec(e)||[];if(!s||!o)return void t(new Error("base64 格式错误"));const c=atob(o),l=new Uint8Array(c.length);for(let e=0;e<c.length;e++)l[e]=c.charCodeAt(e);const r=new Blob([l],{type:"image/png"});a(URL.createObjectURL(r))})),resetImage(){this.cropper&&(this.cropper.destroy(),this.cropper=null),this.imagePath="",this.croppedPath="",this.selectedRatio="free",this.chooseImage()},saveImage(){try{const e=document.createElement("a");e.href=this.croppedPath;const a=(new Date).getTime();e.download=`cropped_image_${a}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),o({title:"开始下载",icon:"success"})}catch(e){o({title:"保存失败",icon:"error"})}}},beforeDestroy(){this.cropper&&(this.cropper.destroy(),this.cropper=null)}},[["render",function(e,a,t,s,o,c){const l=v,r=h,I=R,B=x,T=C,M=P,D=y;return d(),i(r,{class:p(["container",o.currentTheme])},{default:n((()=>[u(r,{class:"header-fixed"},{default:n((()=>[u(r,{class:"back-btn",onClick:c.goBack},{default:n((()=>[u(l,{class:"back-icon"},{default:n((()=>[g("←")])),_:1})])),_:1},8,["onClick"]),u(l,{class:"title"},{default:n((()=>[g("图片裁剪")])),_:1})])),_:1}),u(r,{class:"header-placeholder"}),u(r,{class:"content"},{default:n((()=>[o.imagePath?m("",!0):(d(),i(r,{key:0,class:"upload-box",onClick:c.chooseImage},{default:n((()=>[u(l,{class:"upload-icon"},{default:n((()=>[g("📤")])),_:1}),u(l,{class:"upload-text"},{default:n((()=>[g("点击选择图片")])),_:1}),u(l,{class:"upload-tip"},{default:n((()=>[g("支持jpg、png格式，最大20MB")])),_:1})])),_:1},8,["onClick"])),o.imagePath?(d(),f(_,{key:1},[u(r,{class:"cropper-container"},{default:n((()=>[b("img",{ref:"image",src:o.imagePath,style:{"max-width":"100%"}},null,8,["src"])])),_:1}),u(r,{class:"control-panel"},{default:n((()=>[u(r,{class:"ratio-selector"},{default:n((()=>[u(l,{class:"section-title"},{default:n((()=>[g("裁剪比例:")])),_:1}),u(T,{class:"ratio-group",onChange:c.onRatioChange},{default:n((()=>[(d(!0),f(_,null,k(o.ratios,(e=>(d(),i(B,{class:"ratio-item",key:e.value},{default:n((()=>[u(I,{value:e.value,checked:o.selectedRatio===e.value},null,8,["value","checked"]),u(l,null,{default:n((()=>[g(w(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onChange"])])),_:1}),u(M,{class:"primary-btn",onClick:c.cropImage},{default:n((()=>[g("开始裁剪")])),_:1},8,["onClick"]),o.croppedPath?(d(),i(M,{key:0,class:"save-btn",onClick:c.saveImage},{default:n((()=>[g("保存图片")])),_:1},8,["onClick"])):m("",!0),u(M,{class:"reset-btn",onClick:c.resetImage},{default:n((()=>[g("重新选择")])),_:1},8,["onClick"])])),_:1}),o.croppedPath?(d(),i(r,{key:0,class:"preview-box"},{default:n((()=>[u(l,{class:"preview-title"},{default:n((()=>[g("裁剪预览")])),_:1}),u(D,{src:o.croppedPath,mode:"aspectFit",class:"preview-image"},null,8,["src"])])),_:1})):m("",!0)],64)):m("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-ba61ea45"]]);export{B as default};
